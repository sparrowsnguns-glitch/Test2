<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SecureSphere Atelier â€” Cyber-Security as Art</title>
<meta name="description" content="Interaktives Security-Atelier: kÃ¼nstlerische One-Page mit Security Self-Check & Live-Page-Quickchecks â€” DSGVO-freundlich, lokal, ohne Tracking." />
<!-- privacy-first: use system fonts (no external calls) -->
<style>
  /* ====== Theme & base (brighter palette) ====== */
  :root{
    --bg:#f5f7fb;
    --panel:#ffffff;
    --glass: rgba(11,18,32,0.03);
    --accent1: #00aaff;
    --accent2: #7a00ff;
    --muted: #6b7280;
    --text: #07122a;
    --success: #0fa37a;
    --warn: #d97706;
    --danger: #dc2626;
    --glass-border: rgba(11,18,32,0.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  a{color:inherit}
  .skip{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
  .skip:focus{left:1rem;top:1rem;width:auto;height:auto;padding:.5rem .75rem;background:#fff;color:#000;border-radius:6px;z-index:10000}
  main{min-height:100vh;position:relative;overflow:hidden}
  header{position:fixed;top:0;left:0;right:0;z-index:40;padding:.9rem 1.4rem;display:flex;align-items:center;justify-content:space-between;backdrop-filter: blur(6px);background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));border-bottom:1px solid rgba(11,18,32,0.04)}
  .brand{display:flex;align-items:center;gap:.6rem;font-weight:700;letter-spacing:.4px;color:var(--text)}
  .brand .logo-dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 6px 18px rgba(122,0,255,0.06), 0 0 28px rgba(0,170,255,0.04)}
  nav ul{display:flex;gap:1rem;list-style:none;margin:0;padding:0}
  nav a{color:var(--muted);text-decoration:none;padding:.35rem .45rem;border-radius:6px;transition:all .18s ease}
  nav a:hover, nav a[aria-current="page"]{color:var(--text);background:linear-gradient(90deg,rgba(0,0,0,0.03), rgba(0,0,0,0.01));box-shadow:0 6px 18px rgba(11,18,32,0.04)}
  header .cta{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021226;padding:.5rem .9rem;border-radius:10px;font-weight:700;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(0,170,255,.06)}
  /* ===== Hero: art + content ===== */
  .hero{
    min-height:100vh;display:grid;align-items:center;grid-template-columns:1fr;place-items:center;padding:6rem 1.2rem;
    position:relative;z-index:2;
  }
  .hero .canvas-wrap{position:absolute;inset:0;z-index:1;pointer-events:none}
  .hero .glass {
    width:min(1100px,94%);background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.92));
    border-radius:18px;padding:2.4rem;display:grid;grid-template-columns:1fr 420px;gap:1.5rem;align-items:center;backdrop-filter: blur(6px);
    border:1px solid var(--glass-border);box-shadow: 0 12px 40px rgba(11,18,32,0.06);
    position:relative;z-index:3;overflow:hidden;
  }
  .hero h1{
    font-size:clamp(1.6rem,4vw,3rem);margin:0 0 .5rem;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    -webkit-background-clip: text; background-clip: text; color: transparent;
  }
  .hero p{color:var(--muted);line-height:1.5;margin:0 0 1rem}
  .hero .cta-rows{display:flex;flex-direction:column;gap:.7rem}
  .big-cta{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021226;padding:.75rem 1.1rem;border-radius:12px;border:none;font-weight:700;cursor:pointer;box-shadow:0 10px 30px rgba(0,170,255,.06);transition:transform .18s}
  .big-cta:hover{transform:translateY(-4px);box-shadow:0 16px 36px rgba(0,170,255,.08)}
  /* right panel - artwork + short stats */
  .right-panel{display:flex;flex-direction:column;gap:1rem;align-items:stretch}
  .art-card{height:260px;border-radius:12px;border:1px solid rgba(11,18,32,0.04);overflow:hidden;background:linear-gradient(180deg,rgba(245,247,251,0.6),rgba(255,255,255,0.6));display:flex;align-items:center;justify-content:center}
  .map-card{
    height:260px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#081226,#021226);border:1px solid rgba(255,255,255,0.06);color:#e6f6ff;position:relative;display:flex;flex-direction:column;
    box-shadow: 0 12px 30px rgba(2,18,38,0.28);
  }
  .map-card canvas{display:block;width:100%;height:100%}
  .map-legend{position:absolute;left:8px;top:8px;background:rgba(2,10,20,0.5);padding:6px 8px;border-radius:8px;font-size:.8rem;color:#e6f6ff;border:1px solid rgba(255,255,255,0.03)}
  .map-controls{position:absolute;right:8px;top:8px;background:rgba(255,255,255,0.035);padding:6px;border-radius:8px;font-size:.8rem;color:#cfefff;display:flex;gap:.4rem;align-items:center}
  .map-status{font-weight:700;font-size:.85rem;margin-left:6px}
  .stats{display:flex;gap:.8rem;background:transparent;border-radius:10px;padding:.6rem}
  .stat{flex:1;text-align:center}
  .stat h4{margin:0;color:var(--accent1);font-size:1.05rem}
  .stat p{margin:0;color:var(--muted);font-size:.85rem}
  /* ===== Sections ===== */
  section.card-section{padding:4rem 1.2rem 6rem}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;max-width:1100px;margin:0 auto}
  .card{background:var(--panel);border-radius:12px;padding:1.2rem;border:1px solid rgba(11,18,32,0.04);box-shadow:0 8px 24px rgba(11,18,32,0.04);transition:transform .18s, box-shadow .18s}
  .card:hover{transform:translateY(-6px);box-shadow:0 18px 44px rgba(11,18,32,0.06)}
  .card h3{color:var(--accent2);margin-bottom:.5rem}
  .card p{color:var(--muted);font-size:.95rem}
  /* security check CTA */
  .check-cta{display:flex;gap:1rem;justify-content:center;margin-top:1rem}
  /* footer */
  footer{padding:2rem 1.2rem;text-align:center;color:var(--muted);border-top:1px solid rgba(11,18,32,0.04);position:relative;z-index:2}
  /* ===== Popup widget styling ===== */
  .widget-toggle{position:fixed;right:2.2rem;bottom:2.2rem;z-index:200;background:linear-gradient(135deg,var(--accent1),var(--accent2));border-radius:14px;padding:.6rem .8rem;border:none;color:#021226;font-weight:800;cursor:pointer;box-shadow:0 12px 40px rgba(0,170,255,.06)}
  .atelier{
    position:fixed;right:2.2rem;bottom:6.6rem;width:380px;max-width:94vw;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.995));border-radius:14px;padding:1rem;border:1px solid rgba(11,18,32,0.04);z-index:200;box-shadow:0 30px 70px rgba(11,18,32,0.08);transform:translateY(24px);opacity:0;transition:all .28s;backdrop-filter: blur(6px)}
  .atelier.open{transform:translateY(0);opacity:1}
  .atelier h4{margin:0;color:var(--accent1);font-size:1.05rem}
  .atelier .section{margin-top:.6rem}
  .atelier label{display:block;font-size:.95rem;color:var(--muted);margin:.35rem 0}
  .atelier input[type="radio"]{margin-right:.4rem}
  .atelier .run{display:flex;gap:.45rem;margin-top:.6rem}
  .atelier .run button{flex:1;padding:.6rem;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021226;padding:.5rem .6rem;border-radius:8px;border:none;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(11,18,32,0.04);color:var(--muted);padding:.45rem .6rem;border-radius:8px;cursor:pointer}
  .result{margin-top:.6rem;padding:.55rem;border-radius:8px;font-weight:700;text-align:center}
  .todo{margin-top:.6rem;background:linear-gradient(180deg, rgba(245,247,251,0.7), rgba(255,255,255,0.9));padding:.6rem;border-radius:8px;border:1px dashed rgba(11,18,32,0.04);color:var(--muted);font-size:.9rem}
  /* responsive */
  @media (max-width:980px){.hero .glass{grid-template-columns:1fr;gap:1rem}.right-panel{order:2}.hero{padding-top:5.6rem}}
  @media (max-width:560px){header{padding:.7rem 1rem}.brand{font-size:.95rem}}
  /* visible focus ring */
  :focus{outline:3px solid rgba(0,170,255,0.12);outline-offset:2px}
</style>
</head>
<body>
  <a class="skip" href="#main">Zum Inhalt springen</a>

  <header>
    <div class="brand"><span class="logo-dot" aria-hidden="true"></span>SecureSphere Atelier</div>
    <nav aria-label="Hauptnavigation">
      <ul>
        <li><a href="#start">Start</a></li>
        <li><a href="#offer">Leistungen</a></li>
        <li><a href="#check">Security-Check</a></li>
        <li><a href="#contact">Kontakt</a></li>
      </ul>
    </nav>
    <button class="cta" id="headerCta" type="button">Kostenlose Erstberatung</button>
  </header>

  <main id="main">
    <!-- generative canvas background -->
    <div class="hero">
      <div class="canvas-wrap" aria-hidden="true">
        <canvas id="bgc" style="width:100%;height:100%;display:block"></canvas>
        <!-- subtle SVG noise overlay -->
        <svg style="position:absolute;inset:0;z-index:1;pointer-events:none" preserveAspectRatio="none" viewBox="0 0 100 100">
          <defs>
            <linearGradient id="lg" x1="0" x2="1"><stop offset="0" stop-color="rgba(0,170,255,0.05)"/><stop offset="1" stop-color="rgba(122,0,255,0.04)"/></linearGradient>
          </defs>
          <rect x="0" y="0" width="100" height="100" fill="url(#lg)"/>
        </svg>
      </div>

      <div class="glass" role="region" aria-label="Hero Panel">
        <div style="padding-right:1.2rem;">
          <h1 style="margin-bottom:.4rem">Cyber-Security â€” technisch & poetisch</h1>
          <p>Ein interaktives Atelier, das Kunst und Sicherheit verbindet. Testen Sie Ihre Abwehrkraft, bekommen Sie sofort priorisierte To-Dos und erleben einen visuellen QualitÃ¤ts-Check Ihrer Seite.</p>
          <div class="cta-rows">
            <button class="big-cta" id="openWidgetBtn" type="button">Security-Atelier Ã¶ffnen</button>
            <div style="display:flex;gap:.6rem;align-items:center">
              <small style="color:var(--muted)">Quick-metrics:</small>
              <div class="stats" role="list" aria-hidden="false" style="margin-left:.6rem">
                <div class="stat"><h4 id="s-proto">--</h4><p>Protokoll</p></div>
                <div class="stat"><h4 id="s-mix">--</h4><p>Mixed Content</p></div>
                <div class="stat"><h4 id="s-cook">--</h4><p>Cookies</p></div>
              </div>
            </div>
          </div>
        </div>

        <aside class="right-panel" aria-hidden="false">
          <!-- Realtime map (contrasting dark card) -->
          <div class="map-card" role="region" aria-label="Echtzeit Netzwerk-Map">
            <canvas id="mapcard" width="420" height="260" aria-label="Netzwerk-Map"></canvas>
            <div class="map-legend" id="mapLegend" aria-hidden="false">
              <div><span style="display:inline-block;width:10px;height:10px;background:#28c76f;border-radius:50%;margin-right:6px;vertical-align:middle"></span> Online</div>
              <div><span style="display:inline-block;width:10px;height:10px;background:#f59e0b;border-radius:50%;margin-right:6px;vertical-align:middle"></span> Warnung</div>
              <div><span style="display:inline-block;width:10px;height:10px;background:#ef4444;border-radius:50%;margin-right:6px;vertical-align:middle"></span> Ausfall</div>
            </div>
            <div class="map-controls" aria-hidden="false">
              <label style="font-size:.75rem">Live</label>
              <input type="checkbox" id="mapLiveToggle" aria-label="Live updates an/aus" checked>
              <span class="map-status" id="mapStatus">Simulieren</span>
            </div>
          </div>

          <div style="display:flex;gap:.6rem;margin-top:.2rem">
            <div class="stat" style="flex:1"><h4>99%</h4><p>RegelmÃ¤ÃŸige Tests</p></div>
            <div class="stat" style="flex:1"><h4>24/7</h4><p>Monitoring</p></div>
          </div>
        </aside>
      </div>
    </div>

    <!-- services as art-card section -->
    <section id="offer" class="card-section" aria-labelledby="offer-title">
      <h2 id="offer-title" style="text-align:center;color:var(--accent2);margin-bottom:1rem">Unsere Leistungen (Auszug)</h2>
      <div class="cards" role="list">
        <article class="card" role="listitem">
          <h3>Penetration Testing & Red Team</h3>
          <p>RealitÃ¤tsnahe Angriffe, Business-context aware: Wir prÃ¼fen Web, Netzwerk, Cloud und menschliche Faktoren.</p>
        </article>
        <article class="card" role="listitem">
          <h3>Awareness & Simulated Phishing</h3>
          <p>Kontinuierliche Schulungen mit messbaren KPIs, adaptiven Lernpfaden und Reporting fÃ¼r Manager.</p>
        </article>
        <article class="card" role="listitem">
          <h3>Cloud-HÃ¤rtung & IaC Review</h3>
          <p>Secure by design: Policies, IAM, Secrets Management, Infrastructure as Code Reviews (Terraform, ARM).</p>
        </article>
        <article class="card" role="listitem">
          <h3>Incident Response & Forensics</h3>
          <p>Schnelle Incident-Containment, Beweissicherung und Wiederherstellung mit dokumentierten Playbooks.</p>
        </article>
      </div>
      <div class="check-cta">
        <button class="big-cta" style="max-width:320px" id="openWidgetBtn2" type="button">Sofort testen â€” Security-Atelier</button>
      </div>
    </section>

    <!-- security check anchor -->
    <section id="check" class="card-section" aria-labelledby="check-title">
      <h2 id="check-title" style="text-align:center;color:var(--accent2);margin-bottom:.4rem">Security-Atelier (Mini-Selfcheck)</h2>
      <p style="text-align:center;color:var(--muted);max-width:80ch;margin:0 auto 1rem">Beantworten Sie 6 kurze Fragen â€” die Auswertung kombiniert Antworten mit einer Live-Page-Quick-Analyse (nur lokal, nichts wird gesendet).</p>

      <div style="max-width:900px;margin:1.2rem auto;display:grid;grid-template-columns:1fr 340px;gap:1rem">
        <div>
          <div class="card" style="margin-bottom:1rem">
            <h3 style="margin-bottom:.6rem">Interaktiver Self-Check</h3>
            <p style="color:var(--muted);margin-top:0">Antworte ehrlich â€” wir geben eine priorisierte To-Do Liste.</p>
            <ol id="q-list" style="color:var(--muted);margin-top:.8rem">
              <li>Ist 2-Faktor Ã¼berall aktiviert?</li>
              <li>Gibt es regelmÃ¤ÃŸige Phishing-Tests?</li>
              <li>Werden Patches zeitnah eingespielt?</li>
              <li>Existiert ein getestetes Backup-Konzept?</li>
              <li>Nutzen Sie sichere Cloud-Provider mit EU-Hosting?</li>
              <li>Sind TLS/SSL & HSTS Ã¼berall aktiv?</li>
            </ol>
            <div style="margin-top:.8rem;display:flex;gap:.6rem;flex-wrap:wrap">
              <button class="btn-ghost demo-btn" data-demo="yes" type="button">Alles Ja (Demo)</button>
              <button class="btn-ghost demo-btn" data-demo="no" type="button">Alles Nein (Demo)</button>
              <button class="btn-primary" id="openWidgetBtn3" type="button">Check jetzt</button>
            </div>
          </div>

          <div class="card">
            <h3>Live-Page Quickchecks (automatisch)</h3>
            <p style="color:var(--muted)">Wir scannen deine Seite clientseitig und zeigen Hinweise â€” kein Netzwerk-Upload.</p>
            <ul id="quickchecks" style="color:var(--muted);margin-top:.6rem"></ul>
            <div style="margin-top:.8rem">
              <button class="btn-ghost" id="runQuickBtn" type="button">Quickcheck neu ausfÃ¼hren</button>
            </div>
          </div>
        </div>

        <aside class="card">
          <h3>Auswertung & To-Dos</h3>
          <div id="atelier-result" style="margin-top:.6rem;font-weight:700;color:var(--muted)">Noch kein Ergebnis â€” starte den Check.</div>
          <div id="todo-list" class="todo" style="display:none"></div>
          <div style="margin-top:.6rem">
            <button class="btn-primary" id="copyTodosBtn" type="button">To-Dos kopieren</button>
          </div>
        </aside>
      </div>
    </section>

    <section id="contact" class="card-section" aria-labelledby="contact-title">
      <h2 id="contact-title" style="text-align:center;color:var(--accent2);margin-bottom:.6rem">Kontakt</h2>
      <div style="max-width:800px;margin:0 auto">
        <div class="card" style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <h3>Sie wollen mehr als einen Quickcheck?</h3>
            <p style="color:var(--muted)">Buchen Sie eine kostenlose Erstberatung: 30 Minuten, remote oder vor Ort. Wir liefern Audit-Roadmap & Budgetrahmen.</p>
          </div>
          <form id="contactForm" style="min-width:240px;display:flex;flex-direction:column;gap:.6rem">
            <input type="text" name="name" placeholder="Name" required style="padding:.6rem;border-radius:8px;border:1px solid rgba(11,18,32,.04);background:transparent;color:var(--text)">
            <input type="email" name="email" placeholder="E-Mail" required style="padding:.6rem;border-radius:8px;border:1px solid rgba(11,18,32,.04);background:transparent;color:var(--text)">
            <button class="btn-primary" type="submit">Beratung anfragen</button>
          </form>
        </div>
      </div>
    </section>

    <footer>
      Â© 2025 SecureSphere Atelier â€” Kunst & Cyber-Security Â· <a href="#" style="color:var(--accent1)">Impressum</a>
    </footer>
  </main>

  <!-- Widget toggle + Atelier -->
  <button class="widget-toggle" id="toggleBtn" aria-expanded="false" aria-controls="atelier" title="Security Atelier" type="button">â˜…</button>

  <div class="atelier" id="atelier" role="dialog" aria-labelledby="atelier-title" aria-hidden="true" aria-modal="true">
    <h4 id="atelier-title">Security-Atelier â€” Mini-Check</h4>

    <div class="section">
      <label>1. Nutzen Sie 2-Faktor Ã¼berall?</label>
      <label><input type="radio" name="cq1" value="1"> Ja</label><label><input type="radio" name="cq1" value="0"> Nein</label>
    </div>
    <div class="section">
      <label>2. RegelmÃ¤ÃŸige Phishing-Tests?</label>
      <label><input type="radio" name="cq2" value="1"> Ja</label><label><input type="radio" name="cq2" value="0"> Nein</label>
    </div>
    <div class="section">
      <label>3. Patches zeitnah?</label>
      <label><input type="radio" name="cq3" value="1"> Ja</label><label><input type="radio" name="cq3" value="0"> Nein</label>
    </div>
    <div class="section">
      <label>4. Getestetes Backup?</label>
      <label><input type="radio" name="cq4" value="1"> Ja</label><label><input type="radio" name="cq4" value="0"> Nein</label>
    </div>
    <div class="section">
      <label>5. TLS/HSTS Ã¼berall?</label>
      <label><input type="radio" name="cq5" value="1"> Ja</label><label><input type="radio" name="cq5" value="0"> Nein</label>
    </div>
    <div class="section">
      <label>6. Externe Widgets DSGVO-konform?</label>
      <label><input type="radio" name="cq6" value="1"> Ja</label><label><input type="radio" name="cq6" value="0"> Nein</label>
    </div>

    <div class="run">
      <button class="btn-primary" id="runAtelierBtn" type="button">Auswerten</button>
      <button class="btn-ghost" id="closeAtelierBtn" type="button">SchlieÃŸen</button>
    </div>

    <div id="atelier-output" style="margin-top:.6rem"></div>
  </div>

<script>
/* =========================
   Helpers & improvements:
   - DPR-aware canvas scaling
   - debounced resize
   - pause animations on hidden tab
   - focus management & trap for dialog
   - Realtime map (client-side, simulated by default)
   =========================*/

/* ---- Utility functions ---- */
function fitCanvasToDisplaySize(canvas) {
  const dpr = window.devicePixelRatio || 1;
  const cssWidth = canvas.clientWidth || canvas.width;
  const cssHeight = canvas.clientHeight || canvas.height;
  const displayWidth  = Math.round(cssWidth * dpr);
  const displayHeight = Math.round(cssHeight * dpr);
  if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
    canvas.width = displayWidth;
    canvas.height = displayHeight;
    const ctx = canvas.getContext('2d');
    if (ctx && ctx.setTransform) ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    return true;
  }
  return false;
}
function debounce(fn, ms=120){
  let t;
  return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); };
}

/* ---- Background generative animation ---- */
(function(){
  const c = document.getElementById('bgc'), ctx = c.getContext('2d');
  let W = c.width = innerWidth, H = c.height = innerHeight;
  let paused = false;
  let pts = [];
  const grid = 28;

  function init(){
    pts = [];
    for(let y=0;y<=grid;y++){
      for(let x=0;x<=grid;x++){
        pts.push({x: x/grid*W + (Math.random()-0.5)*W*0.02, y: y/grid*H + (Math.random()-0.5)*H*0.02, vx:(Math.random()-0.5)*0.2, vy:(Math.random()-0.5)*0.2});
      }
    }
  }

  function onResize(){
    W = c.width = innerWidth;
    H = c.height = innerHeight;
    fitCanvasToDisplaySize(c);
    init();
  }
  const debouncedResize = debounce(onResize,120);
  window.addEventListener('resize', debouncedResize);
  document.addEventListener('visibilitychange', ()=>{ paused = document.hidden; if(!paused) requestAnimationFrame(draw); });

  init();
  function draw(){
    if(paused) return;
    ctx.clearRect(0,0,W,H);
    // subtle background gradient
    let g = ctx.createLinearGradient(0,0,W,H);
    g.addColorStop(0,'rgba(245,247,251,0.95)');
    g.addColorStop(1,'rgba(241,244,248,0.95)');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
    ctx.globalCompositeOperation = 'lighter';
    for(let i=0;i<pts.length;i++){
      const p = pts[i];
      p.x += p.vx; p.y += p.vy;
      if(p.x < -50) p.x = W+50; if(p.x>W+50) p.x=-50;
      if(p.y < -50) p.y = H+50; if(p.y>H+50) p.y=-50;
      for(let j=i+1;j<pts.length;j++){
        const q = pts[j];
        const dx = p.x-q.x, dy = p.y-q.y, d = Math.hypot(dx,dy);
        if(d<160){
          ctx.strokeStyle = 'rgba(0,170,255,'+ (0.08*(1-d/160)) +')';
          ctx.lineWidth = 1;
          ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y); ctx.stroke();
        }
      }
    }
    // floating specks
    for(let k=0;k<24;k++){
      ctx.fillStyle = 'rgba(0,170,255,0.02)';
      ctx.beginPath(); ctx.arc((W/24*k + (Date.now()/200)%W)%W, Math.abs((H/6*Math.sin((Date.now()/1000)+k))%H), 2, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalCompositeOperation = 'source-over';
    requestAnimationFrame(draw);
  }
  // initial fit
  fitCanvasToDisplaySize(c);
  requestAnimationFrame(draw);
})();

/* ---- Realtime Map (client-side) ---- */
(function(){
  const canvas = document.getElementById('mapcard');
  const ctx = canvas.getContext('2d');
  let paused = false;

  function resize(){ fitCanvasToDisplaySize(canvas); draw(); }
  window.addEventListener('resize', debounce(resize,120));
  document.addEventListener('visibilitychange', ()=>{ paused = document.hidden; if(!paused) draw(); });

  // topology (sample)
  const nodes = [
    {id:'gw', name:'Gateway', x:0.5, y:0.08, status:0, info:'Perimeter-Gateway'},
    {id:'fw', name:'Firewall', x:0.5, y:0.22, status:0, info:'Next-gen FW'},
    {id:'web1', name:'Web-01', x:0.2, y:0.46, status:0, info:'nginx - EU'},
    {id:'web2', name:'Web-02', x:0.8, y:0.46, status:0, info:'nginx - EU'},
    {id:'db', name:'DB-Cluster', x:0.5, y:0.72, status:0, info:'Postgres Cluster'},
    {id:'log', name:'SIEM', x:0.12, y:0.82, status:0, info:'Logs & Alerting'},
    {id:'cdn', name:'Edge-CDN', x:0.88, y:0.18, status:0, info:'CDN - Edge'}
  ];
  const links = [
    ['gw','fw'], ['fw','web1'], ['fw','web2'], ['web1','db'], ['web2','db'], ['db','log'], ['gw','cdn']
  ];

  let hoverNode = null;
  const COLORS = {0:'#28c76f',1:'#f59e0b',2:'#ef4444',link:'#2aa6ff',bgGradStart:'#071226',bgGradEnd:'#021226',glow:'#6ad1ff33'};

  function clear(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

  function draw(){
    if(paused) return;
    fitCanvasToDisplaySize(canvas);
    const W = canvas.clientWidth, H = canvas.clientHeight;
    clear();
    // background
    const g = ctx.createLinearGradient(0,0,W,H);
    g.addColorStop(0,COLORS.bgGradStart); g.addColorStop(1,COLORS.bgGradEnd);
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

    // links
    ctx.lineWidth = 2;
    links.forEach(([a,b])=>{
      const na = nodes.find(n=>n.id===a), nb = nodes.find(n=>n.id===b);
      if(!na||!nb) return;
      const ax = na.x*W, ay = na.y*H, bx = nb.x*W, by = nb.y*H;
      const grad = ctx.createLinearGradient(ax,ay,bx,by);
      grad.addColorStop(0,'rgba(42,166,255,0.14)'); grad.addColorStop(1,'rgba(42,166,255,0.04)');
      ctx.strokeStyle = grad;
      ctx.beginPath(); ctx.moveTo(ax,ay); ctx.lineTo(bx,by); ctx.stroke();
    });

    // nodes
    nodes.forEach(n=>{
      const x = n.x*W, y = n.y*H;
      // glow
      ctx.beginPath();
      ctx.fillStyle = COLORS.glow;
      ctx.arc(x,y,18,0,Math.PI*2);
      ctx.fill();
      // circle
      ctx.beginPath();
      ctx.fillStyle = COLORS[n.status] || COLORS[0];
      ctx.arc(x,y,10,0,Math.PI*2);
      ctx.fill();
      // rings
      if(n.status===1){
        ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(245,158,11,0.9)'; ctx.arc(x,y,14,0,Math.PI*2); ctx.stroke();
      } else if(n.status===2){
        ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(239,68,68,0.95)'; ctx.arc(x,y,16,0,Math.PI*2); ctx.stroke();
      }
      // label
      ctx.font = '11px system-ui,Arial';
      ctx.fillStyle = 'rgba(230,246,255,0.95)';
      ctx.textAlign = 'center';
      ctx.fillText(n.name, x, y + 28);
    });

    // tooltip
    if(hoverNode){
      const n = hoverNode;
      const x = n.x*W, y = n.y*H;
      const lines = [n.name, n.info, `Status: ${n.status===0?'Online': n.status===1? 'Warnung' : 'Ausfall'}`];
      const pad = 8;
      ctx.font = '12px system-ui,Arial';
      const w = Math.max(...lines.map(l=>ctx.measureText(l).width)) + pad*2;
      const h = lines.length*18 + pad;
      const tx = Math.min(W - w - 10, Math.max(10, x + 12));
      const ty = Math.min(H - h - 10, Math.max(10, y - h - 12));
      ctx.fillStyle = 'rgba(2,10,20,0.88)';
      roundRect(ctx, tx, ty, w, h, 8, true, false);
      ctx.fillStyle = '#e6f6ff';
      lines.forEach((line,i)=> ctx.fillText(line, tx + w/2, ty + pad + 14 + i*18));
    }
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke){
    if (r === undefined) r = 5;
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.arcTo(x + w, y, x + w, y + h, r);
    ctx.arcTo(x + w, y + h, x, y + h, r);
    ctx.arcTo(x, y + h, x, y, r);
    ctx.arcTo(x, y, x + w, y, r);
    ctx.closePath();
    if(fill) ctx.fill();
    if(stroke) ctx.stroke();
  }

  function getNodeAt(px, py){
    const rect = canvas.getBoundingClientRect();
    const x = (px - rect.left), y = (py - rect.top);
    const W = canvas.clientWidth, H = canvas.clientHeight;
    for(let n of nodes){
      const nx = n.x*W, ny = n.y*H;
      const d = Math.hypot(nx - x, ny - y);
      if(d <= 14) return n;
    }
    return null;
  }

  canvas.addEventListener('mousemove', e=>{
    const n = getNodeAt(e.clientX, e.clientY);
    if(n) hoverNode = n;
    else hoverNode = null;
    draw();
  });
  canvas.addEventListener('mouseleave', ()=>{ hoverNode = null; draw(); });
  canvas.addEventListener('click', e=>{
    const n = getNodeAt(e.clientX, e.clientY);
    if(n){
      const statusText = n.status===0?'Online': n.status===1? 'Warnung' : 'Ausfall';
      alert(`${n.name}\n${n.info}\nStatus: ${statusText}\n\n(Demo-Details, keine Daten werden gesendet)`);
    }
  });

  // Simulation / Live feed placeholder
  let simInterval = null;
  let liveEnabled = true;
  const liveToggle = document.getElementById('mapLiveToggle');
  const mapStatus = document.getElementById('mapStatus');

  function startSimulation(){
    stopSimulation();
    simInterval = setInterval(()=>{
      const idx = Math.floor(Math.random()*nodes.length);
      const rnd = Math.random();
      if(rnd < 0.04) nodes[idx].status = 2;
      else if(rnd < 0.18) nodes[idx].status = 1;
      else nodes[idx].status = 0;
      draw();
      pulseAlert(idx);
      // also reflect a minimal "incident" feed message in the status label for demo
      const incident = rnd < 0.06;
      mapStatus.textContent = incident ? 'Incident detected' : (liveEnabled ? 'Simulieren' : 'Pausiert');
    }, 1500);
  }
  function stopSimulation(){ if(simInterval) clearInterval(simInterval); simInterval = null; }

  function pulseAlert(idx){
    const n = nodes[idx];
    const start = Date.now();
    (function fade(){
      const t = (Date.now()-start)/700;
      if(t>1) return;
      draw();
      const W = canvas.clientWidth, H = canvas.clientHeight;
      const x = n.x*W, y = n.y*H;
      ctx.beginPath();
      ctx.fillStyle = `rgba(42,166,255,${0.18*(1-t)})`;
      ctx.arc(x,y,24*(1+0.6*t),0,Math.PI*2);
      ctx.fill();
      requestAnimationFrame(fade);
    })();
  }

  // feedRealtime: call from external code to push statuses [{id:'web1', status:2}, ...]
  function feedRealtime(update){
    if(!update) return;
    if(update.nodes && Array.isArray(update.nodes)){
      update.nodes.forEach(u=>{
        const n = nodes.find(x=>x.id===u.id);
        if(n && typeof u.status === 'number') n.status = u.status;
      });
      draw();
    }
    // incident feed: if update.incident exists, show a brief message
    if(update.incident){
      mapStatus.textContent = update.incident;
      setTimeout(()=>{ mapStatus.textContent = liveEnabled ? 'Simulieren' : 'Pausiert'; }, 3500);
    }
  }

  liveToggle.addEventListener('change', (e)=>{
    liveEnabled = !!e.target.checked;
    if(liveEnabled){ startSimulation(); mapStatus.textContent = 'Simulieren'; }
    else { stopSimulation(); mapStatus.textContent = 'Pausiert'; }
  });

  startSimulation();
  draw();

  // Expose for integration:
  // - window.__mapFeed({nodes:[{id:'web1',status:2}], incident: 'SQLi detected on Web-01'})
  window.__mapFeed = feedRealtime;
  window.__mapNodes = nodes; // debug access
})();

/* =========================
   Widget logic & quick checks (improved)
   ========================= */
const atelier = document.getElementById('atelier'),
      toggleBtn = document.getElementById('toggleBtn'),
      atelierOutput = document.getElementById('atelier-output'),
      openWidgetButtons = document.querySelectorAll('#openWidgetBtn, #openWidgetBtn2, #openWidgetBtn3'),
      openWidgetBtn = document.getElementById('openWidgetBtn'),
      runAtelierBtn = document.getElementById('runAtelierBtn'),
      closeAtelierBtn = document.getElementById('closeAtelierBtn'),
      runQuickBtn = document.getElementById('runQuickBtn'),
      copyTodosBtn = document.getElementById('copyTodosBtn'),
      demoButtons = document.querySelectorAll('.demo-btn'),
      headerCta = document.getElementById('headerCta'),
      contactForm = document.getElementById('contactForm');

let lastFocusedBeforeDialog = null;
function openWidget(){ 
  lastFocusedBeforeDialog = document.activeElement;
  atelier.classList.add('open'); atelier.setAttribute('aria-hidden','false'); toggleBtn.setAttribute('aria-expanded','true');
  atelier.setAttribute('aria-modal','true');
  const first = atelier.querySelector('input, button, [tabindex]:not([tabindex="-1"])');
  if(first) first.focus();
  trapFocus(atelier);
}
function closeWidget(){ 
  atelier.classList.remove('open'); atelier.setAttribute('aria-hidden','true'); toggleBtn.setAttribute('aria-expanded','false'); 
  releaseFocusTrap();
  if(lastFocusedBeforeDialog && lastFocusedBeforeDialog.focus) lastFocusedBeforeDialog.focus();
}

/* focus trap */
let focusKeeper = null;
function trapFocus(container){
  const focusable = Array.from(container.querySelectorAll('a[href], area[href], input:not([disabled]), button:not([disabled]), textarea, select, [tabindex]:not([tabindex="-1"])'));
  if(focusable.length === 0) return;
  let idx = 0;
  focusKeeper = function(e){
    if(e.key === 'Tab'){
      e.preventDefault();
      if(e.shiftKey) idx = (idx - 1 + focusable.length) % focusable.length;
      else idx = (idx + 1) % focusable.length;
      focusable[idx].focus();
    } else if(e.key === 'Escape'){
      closeWidget();
    }
  };
  container.addEventListener('keydown', focusKeeper);
}
function releaseFocusTrap(){
  if(!focusKeeper) return;
  atelier.removeEventListener('keydown', focusKeeper);
  focusKeeper = null;
}

/* runAtelier, quickchecks, todos (same as before) */
function runAtelier(){
  const vals = [];
  for(let i=1;i<=6;i++){ const v = document.querySelector(`input[name="cq${i}"]:checked`); vals.push(v?Number(v.value):0) }
  const score = vals.reduce((a,b)=>a+b,0);
  let level = '', color = '';
  if(score>=5){ level='ðŸŸ¢ Sehr gut â€“ geringe AngriffsflÃ¤che'; color='var(--success)'; }
  else if(score>=3){ level='ðŸŸ  Solide â€“ priorisierte MaÃŸnahmen empfohlen'; color='var(--warn)'; }
  else { level='ðŸ”´ Kritisch â€“ dringend handeln'; color='var(--danger)'; }
  atelierOutput.innerHTML = `<div style="padding:.45rem;border-radius:8px;background:rgba(11,18,32,0.03);font-weight:700;color:${color}">${level}</div>`;
  const quick = runQuickChecks();
  const todos = generateTodos(score, quick);
  showTodos(todos);
}

function runQuickChecks(){
  const checks = [];
  const proto = location.protocol === 'https:' ? 'https' : 'http';
  document.getElementById('s-proto').textContent = proto.toUpperCase();
  checks.push({id:'protocol', ok: proto==='https', detail:`Seite Ã¼ber ${proto}`});
  let mixed = false;
  const tags = [...document.querySelectorAll('img, script, iframe, link, source, video, audio')];
  const mixedList = [];
  tags.forEach(el=>{
    const src = el.getAttribute('src') || el.getAttribute('href') || el.getAttribute('data-src') || '';
    if(src){
      const s = src.trim();
      if(s.startsWith('http://') || s.startsWith('//')){ mixed = true; mixedList.push(s); }
    }
    const inlineStyle = el.getAttribute('style') || '';
    if(inlineStyle.includes('http://') || inlineStyle.includes('url(//')){ mixed = true; mixedList.push(inlineStyle.slice(0,120)); }
  });
  const bodyBg = (document.body && document.body.style && document.body.style.backgroundImage) || '';
  if(bodyBg.includes('http://') || bodyBg.includes('//')){ mixed = true; mixedList.push('body background'); }
  document.getElementById('s-mix').textContent = mixed ? 'âš ï¸' : 'âœ“';
  checks.push({id:'mixed', ok: !mixed, detail: mixed ? `Unsichere Ressourcen: ${mixedList.slice(0,3).join(', ')}` : 'Keine http:// oder // Ressourcen gefunden'});
  const cookiesEnabled = navigator.cookieEnabled;
  document.getElementById('s-cook').textContent = cookiesEnabled ? 'âœ“' : 'âš ï¸';
  checks.push({id:'cookies', ok: cookiesEnabled, detail: cookiesEnabled ? 'Cookies aktiviert' : 'Cookies deaktiviert oder blockiert'});
  let cspPresent = false;
  try{ const meta = document.querySelector('meta[http-equiv="Content-Security-Policy"], meta[name="content-security-policy"]'); if(meta) cspPresent = true; }catch(e){}
  checks.push({id:'csp', ok:cspPresent, detail: cspPresent ? 'CSP meta tag found' : 'Keine CSP meta gefunden (Header nicht prÃ¼fbar clientseitig)'});
  let hsts = false;
  if(location.protocol!=='https:') hsts = false;
  checks.push({id:'hsts', ok:hsts, detail: hsts ? 'HSTS vermutlich aktiv' : 'HSTS nicht prÃ¼fbar clientseitig â€” prÃ¼fen via server/SSL Labs'});
  const ul = document.getElementById('quickchecks'); ul.innerHTML='';
  checks.forEach(c=>{
    const li=document.createElement('li'); li.style.marginBottom='.35rem';
    li.textContent = `${c.ok ? 'âœ“' : 'âš '} ${c.detail}`;
    ul.appendChild(li);
  });
  return checks;
}

function generateTodos(score, quick){
  const todos = [];
  if(score<3) todos.push({prio:1,text:'Ein Notfall-Plan & getestete Backups implementieren und dokumentieren.'});
  if(score<5) todos.push({prio:2,text:'Zwei-Faktor-Authentifizierung systemweit erzwingen (MFA).' });
  if(score<4) todos.push({prio:2,text:'RegelmÃ¤ÃŸige Patch-Policy einfÃ¼hren und SLA fÃ¼r kritische Patches.'});
  todos.push({prio:3,text:'Awareness Programm starten: Phishing-Simulation + Reporting.'});
  quick.forEach(c=>{
    if(c.id==='protocol' && !c.ok) todos.unshift({prio:0,text:'HTTPS erzwingen: Zertifikat installieren und HSTS aktivieren (Let\\'s Encrypt mÃ¶glich).'});
    if(c.id==='mixed' && !c.ok) todos.unshift({prio:0,text:'Mixed Content reparieren: Alle Ressourcen auf HTTPS umstellen.'});
    if(c.id==='csp' && !c.ok) todos.push({prio:3,text:'Content Security Policy konfigurieren (start with default-src \\'self\\';).'});
  });
  const unique = [];
  todos.forEach(t=>{ if(!unique.find(u=>u.text===t.text)) unique.push(t) });
  unique.sort((a,b)=>a.prio-b.prio);
  return unique;
}

function showTodos(todos){
  const holder = document.getElementById('todo-list'); holder.style.display='block';
  holder.innerHTML = '<strong>Priorisierte To-Dos</strong><ol style="margin:.4rem 0 0 1rem;color:var(--muted)">' + todos.map(t=>`<li>${t.text}</li>`).join('') + '</ol>';
  document.getElementById('atelier-result').textContent = 'Ergebnis erzeugt â€” To-Dos unten';
}

function copyToClipboard(){
  const holder = document.getElementById('todo-list');
  if(!holder || holder.style.display==='none') return alert('Keine ToDos vorhanden.');
  const text = Array.from(holder.querySelectorAll('li')).map(li=>li.textContent).join('\\n- ');
  navigator.clipboard?.writeText('- '+text).then(()=>alert('To-Dos kopiert'),()=>alert('Kopieren nicht mÃ¶glich'));
}

function autoFillYes(){ openWidget(); const arr = [1,1,1,1,1,1]; arr.forEach((v,i)=>{ const r = document.querySelector(`input[name="cq${i+1}"][value="${v}"]`); if(r) r.checked=true }); runAtelier() }
function autoFillNo(){ openWidget(); const arr = [0,0,0,0,0,0]; arr.forEach((v,i)=>{ const r = document.querySelector(`input[name="cq${i+1}"][value="${v}"]`); if(r) r.checked=true }); runAtelier() }

/* --------------------------
   Event wiring
   -------------------------- */
toggleBtn.addEventListener('click', ()=>{ const open = atelier.classList.contains('open'); if(open) closeWidget(); else openWidget(); });
openWidgetButtons.forEach(b => b && b.addEventListener('click', openWidget));
if(openWidgetBtn) openWidgetBtn.addEventListener('click', openWidget);
if(runAtelierBtn) runAtelierBtn.addEventListener('click', runAtelier);
if(closeAtelierBtn) closeAtelierBtn.addEventListener('click', closeWidget);
if(runQuickBtn) runQuickBtn.addEventListener('click', runQuickChecks);
if(copyTodosBtn) copyTodosBtn.addEventListener('click', copyToClipboard);
demoButtons.forEach(btn => btn.addEventListener('click', (e)=>{ const d = btn.getAttribute('data-demo'); if(d==='yes') autoFillYes(); else autoFillNo(); }));
headerCta.addEventListener('click', ()=>{ document.querySelector('#check').scrollIntoView({behavior:'smooth'}); });

if(contactForm) contactForm.addEventListener('submit', (e)=>{ e.preventDefault(); alert('Danke â€” Demo: Formular nicht verbunden.'); });

document.addEventListener('DOMContentLoaded', ()=>{
  runQuickChecks();
  document.getElementById('s-proto').style.opacity = 1;
});

const navLinks = document.querySelectorAll('nav a');
function markNav(){
  const fromTop = pageYOffset + 120;
  navLinks.forEach(link=>{
    const href = link.getAttribute('href');
    if(!href || href.charAt(0) !== '#') return;
    const section = document.querySelector(href);
    if(section){
      if(section.offsetTop <= fromTop && (section.offsetTop + section.offsetHeight) > fromTop){
        link.setAttribute('aria-current','page');
      } else link.removeAttribute('aria-current');
    }
  });
}
document.addEventListener('scroll', markNav); markNav();

document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeWidget() });
</script>
</body>
</html>
